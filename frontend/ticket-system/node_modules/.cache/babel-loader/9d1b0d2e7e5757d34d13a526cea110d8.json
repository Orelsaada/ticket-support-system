{"ast":null,"code":"var _jsxFileName = \"F:\\\\react-small-projects\\\\ticket-support-system\\\\frontend\\\\ticket-system\\\\src\\\\components\\\\LoginPage.js\";\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router\";\nimport axios from \"axios\";\nimport { AuthContext } from \"./AuthContext\";\nimport { UserContext } from \"./UserContext\";\nimport \"./componentsStyles/LoginPage.css\";\n\nconst LoginPage = () => {\n  const [myInputs, setMyInputs] = useState({});\n  const [error, setError] = useState(\"\");\n  const [isAuthenticated, setIsAuthenticated] = useContext(AuthContext);\n  const [user, setUser] = useContext(UserContext);\n  const history = useHistory(); // If token in localstorage, validate token and connect.\n\n  useEffect(() => {\n    const token = localStorage.getItem(\"token\");\n\n    if (token) {\n      axios({\n        method: \"post\",\n        url: \"http://localhost:5000/api/auth/isValidToken\",\n        data: {\n          token\n        }\n      }).then(res => {\n        if (res.data == false) {\n          localStorage.removeItem(\"token\");\n        } else {\n          setIsAuthenticated(true);\n          history.push(\"/my-incidents\");\n        }\n      }).catch(e => console.log(e));\n    }\n  }, []); // Handle form changes\n\n  const handleChange = e => {\n    setMyInputs({ ...myInputs,\n      [e.target.name]: e.target.value\n    });\n  }; // Handle login\n\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    const user = {\n      email: myInputs.email,\n      password: myInputs.password\n    };\n    setError(\"\");\n    axios({\n      method: \"post\",\n      url: \"http://localhost:5000/api/auth\",\n      data: user\n    }).then(res => {\n      // res.data contain user object and token string.\n      if (res.data.token) {\n        localStorage.setItem(\"token\", res.data.token);\n        localStorage.setItem(\"user-id\", res.data.user.id);\n        setIsAuthenticated(true);\n\n        if (res.data.user.role === \"User\") {\n          history.push(\"/my-incidents\");\n        } else if (res.data.user.role == \"Admin\") {\n          history.push(\"/admin-incidents\");\n        }\n      }\n    }).catch(err => setError(err.response.data.msg));\n  };\n\n  return /*#__PURE__*/React.createElement(\"section\", {\n    className: \"login-section\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"main-div\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }\n  }, \"Testing user: \\\"test@test.com\\\", password: 123456\"), error && /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 19\n    }\n  }, error), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"mt-4 mb-4 text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 11\n    }\n  }, \"Login\"), /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"email\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 15\n    }\n  }, \"Email\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"email\",\n    className: \"form-control\",\n    id: \"email\",\n    name: \"email\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"password\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 15\n    }\n  }, \"Password\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"password\",\n    className: \"form-control\",\n    id: \"password\",\n    name: \"password\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    className: \"btn btn-dark\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 13\n    }\n  }, \"Login\")))));\n};\n\nexport default LoginPage;","map":{"version":3,"sources":["F:/react-small-projects/ticket-support-system/frontend/ticket-system/src/components/LoginPage.js"],"names":["React","useState","useEffect","useContext","useHistory","axios","AuthContext","UserContext","LoginPage","myInputs","setMyInputs","error","setError","isAuthenticated","setIsAuthenticated","user","setUser","history","token","localStorage","getItem","method","url","data","then","res","removeItem","push","catch","e","console","log","handleChange","target","name","value","handleSubmit","preventDefault","email","password","setItem","id","role","err","response","msg"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport { useHistory } from \"react-router\";\r\nimport axios from \"axios\";\r\nimport { AuthContext } from \"./AuthContext\";\r\nimport { UserContext } from \"./UserContext\";\r\nimport \"./componentsStyles/LoginPage.css\";\r\n\r\nconst LoginPage = () => {\r\n  const [myInputs, setMyInputs] = useState({});\r\n  const [error, setError] = useState(\"\");\r\n  const [isAuthenticated, setIsAuthenticated] = useContext(AuthContext);\r\n  const [user, setUser] = useContext(UserContext);\r\n  const history = useHistory();\r\n\r\n  // If token in localstorage, validate token and connect.\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (token) {\r\n      axios({\r\n        method: \"post\",\r\n        url: \"http://localhost:5000/api/auth/isValidToken\",\r\n        data: { token },\r\n      })\r\n        .then((res) => {\r\n          if (res.data == false) {\r\n            localStorage.removeItem(\"token\");\r\n          } else {\r\n            setIsAuthenticated(true);\r\n            history.push(\"/my-incidents\");\r\n          }\r\n        })\r\n        .catch((e) => console.log(e));\r\n    }\r\n  }, []);\r\n\r\n  // Handle form changes\r\n  const handleChange = (e) => {\r\n    setMyInputs({\r\n      ...myInputs,\r\n      [e.target.name]: e.target.value,\r\n    });\r\n  };\r\n\r\n  // Handle login\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n\r\n    const user = { email: myInputs.email, password: myInputs.password };\r\n    setError(\"\");\r\n\r\n    axios({\r\n      method: \"post\",\r\n      url: \"http://localhost:5000/api/auth\",\r\n      data: user,\r\n    })\r\n      .then((res) => {\r\n        // res.data contain user object and token string.\r\n        if (res.data.token) {\r\n          localStorage.setItem(\"token\", res.data.token);\r\n          localStorage.setItem(\"user-id\", res.data.user.id);\r\n          setIsAuthenticated(true);\r\n\r\n          if (res.data.user.role === \"User\") {\r\n            history.push(\"/my-incidents\");\r\n          } else if (res.data.user.role == \"Admin\") {\r\n            history.push(\"/admin-incidents\");\r\n          }\r\n        }\r\n      })\r\n      .catch((err) => setError(err.response.data.msg));\r\n  };\r\n\r\n  return (\r\n    <section className=\"login-section\">\r\n      <div className=\"main-div\">\r\n        <p>Testing user: \"test@test.com\", password: 123456</p>\r\n        {error && <p>{error}</p>}\r\n        <div className=\"card-container\">\r\n          <h2 className=\"mt-4 mb-4 text-center\">Login</h2>\r\n          <form onSubmit={handleSubmit}>\r\n            <div className=\"form-group\">\r\n              <label htmlFor=\"email\">Email</label>\r\n              <input\r\n                type=\"email\"\r\n                className=\"form-control\"\r\n                id=\"email\"\r\n                name=\"email\"\r\n                onChange={handleChange}\r\n              ></input>\r\n            </div>\r\n            <div className=\"form-group\">\r\n              <label htmlFor=\"password\">Password</label>\r\n              <input\r\n                type=\"password\"\r\n                className=\"form-control\"\r\n                id=\"password\"\r\n                name=\"password\"\r\n                onChange={handleChange}\r\n              ></input>\r\n            </div>\r\n            <button type=\"submit\" className=\"btn btn-dark\">\r\n              Login\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default LoginPage;\r\n"]},"metadata":{},"sourceType":"module"}